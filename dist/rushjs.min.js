var RushLayer=function(){var t=function(t){var e=this._applyDefaults(t);this._data={},this.source(e.source),this.opacity(e.opacity),this.label(e.label),this.active(e.active),this.position(e.x,e.y)};return t.prototype._defaults={source:null,label:"",opacity:1,active:!0,x:0,y:0},t.prototype._applyDefaults=function(t){var e=Object.create(this._defaults);for(var a in e)"undefined"!=typeof t[a]&&(e[a]=t[a]);return e},t.prototype.source=function(t){if(t){var e="string"==typeof t?document.querySelector(t):t;if(!(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement))return console.error('The "source" option must be a canvas or image element or a string selector to one of them.'),!1;this._data.source=e}return this._data.source||null},t.prototype.label=function(t){if("string"==typeof t)this._data.label=t;else if("undefined"!=typeof t)return console.error('The "label" option must be a string'),!1;return this._data.label},t.prototype.opacity=function(t){if("number"==typeof t)this._data.opacity=Math.max(0,Math.min(1,t));else if("undefined"!=typeof t)return console.error('The "opacity" option must be a number'),!1;return this._data.opacity},t.prototype.active=function(t){return"boolean"==typeof t&&(this._data.active=t),this._data.active},t.prototype.position=function(t,e){return"number"==typeof t&&"number"==typeof t&&(this._data.position={x:t,y:e}),this._data.position},t}(),RushEngine=function(){var t=function(t){var e=this._applyDefaults(t);this._data={createdAt:performance.now()},this.resetLayers(e.layers),"function"==typeof e.stepStart&&(this._data.stepStart=e.stepStart),"function"==typeof e.stepEnd&&(this._data.stepEnd=e.stepEnd),this.target(e.target)?e.autoStart&&this.start():console.error("The engine needs a canvas target, even if it's not onscreen.")};return t.prototype._defaults={target:null,stepStart:null,stepEnd:null,layers:null,autoStart:!0},t.prototype._applyDefaults=function(t){if("object"!=typeof t||"undefined"==typeof t.target)return console.error('The "target" option is required.'),!1;var e=Object.create(this._defaults);for(var a in e)"undefined"!=typeof t[a]&&(e[a]=t[a]);return e},t.prototype.target=function(t){if(t){var e="string"==typeof t?document.querySelector(t):t;if(!(e instanceof HTMLCanvasElement))return console.error('The "target" option must be a canvas element or a string selector to one of them.'),!1;this._data.target=e,this._data.context=e.getContext("2d"),this.setCanvasSize()}return this._data.target||null},t.prototype.setCanvasSize=function(t,e){var a="number"==typeof t?t:this._data.target.clientWidth,r="number"==typeof e?e:this._data.target.clientHeight;this._data.target.width=a,this._data.target.height=r,this._data.size={width:a,height:r}},t.prototype.resetLayers=function(t){if(this._data.layers=[],t instanceof Array)for(var e=0,a=t.length;e<a;e++)this.addLayer(t[e])},t.prototype.addLayer=function(t){return t instanceof RushLayer?(this._data.layers.push(t),t):(console.error('The "layer" parameter must be a RushLayer instance.'),!1)},t.prototype.removeLayer=function(t){if(t instanceof RushLayer||"string"==typeof t&&""!==t)for(var e=this._data.layers.length-1;e>=0;e--){var a=this._data.layers[e];a!==t&&a.label()!==t||this._data.layers.splice(e,1)}else console.error('The "layer" parameter must be a RushLayer instance or a string representing the layer label.');return this._data.layers.length},t.prototype.draw=function(){var t=this._data;t.context.clearRect(0,0,t.size.width,t.size.height);for(var e=0,a=t.layers.length;e<a;e++){var r=t.layers[e];if(r.active()&&r.source()&&r.opacity()){var n=r.position();t.context.globalAlpha=r.opacity(),t.context.drawImage(r.source(),n.x,n.y)}}t.context.globalAlpha=1},t.prototype.start=function(){var t=performance.now();d=this._data,d.startedAt=t,d.lastCall=t,d.running=!0,this.step(t)},t.prototype.step=function(t){var e=this._data,a=t-e.lastCall,r=this;"function"==typeof e.stepStart&&e.stepStart(a,t,e.size),this.draw(),"function"==typeof e.stepEnd&&e.stepEnd(a,t,e.size),e.lastCall=t,e.running&&requestAnimationFrame(function(t){r.step(t)})},t.prototype.stop=function(){this._data.running=!1},t}();